stages:
  - notify

# ğŸ”” Merge Request ë°œìƒ ì‹œ Mattermost ì•Œë¦¼ ì „ì†¡
notify_mattermost:
  stage: notify
  script:
    - if [ -n "$CI_MERGE_REQUEST_IID" ]; then
        curl -X POST -H "Content-Type: application/json" \
          -d '{
            "text": "**ìƒˆë¡œìš´ Merge Requestê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!** ğŸ‰\n
            **í”„ë¡œì íŠ¸:** '"$CI_PROJECT_NAME"'\n
            **ì‘ì„±ì:** '"$GITLAB_USER_LOGIN"'\n
            **ë¸Œëœì¹˜:** '"$CI_COMMIT_REF_NAME"'\n
            **MR ì œëª©:** '"${CI_MERGE_REQUEST_TITLE:-ì œëª© ì—†ìŒ}"'\n
            [**Merge Request ë³´ê¸°**]('"$CI_PROJECT_URL"'/-/merge_requests/$CI_MERGE_REQUEST_IID")"
          }' \
          https://meeting.ssafy.com/hooks/9ecrs1m8ybbtfpa5dxsms8n4zo || echo "Mattermost ì•Œë¦¼ ì‹¤íŒ¨"
      else
        echo "ğŸš« MR ì •ë³´ ì—†ìŒ"
      fi

# ğŸ”” Issue ë°œìƒ ì‹œ Mattermost ì•Œë¦¼ ì „ì†¡
notify_issue:
  stage: notify
  script:
    - if [ -n "$CI_JOB_ID" ]; then
        curl -X POST -H "Content-Type: application/json" \
          -d '{
            "text": "**ìƒˆë¡œìš´ Issueê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!** ğŸš€\n
            **í”„ë¡œì íŠ¸:** '"$CI_PROJECT_NAME"'\n
            **ì‘ì„±ì:** '"$GITLAB_USER_LOGIN"'\n
            **ë¸Œëœì¹˜:** '"$CI_COMMIT_REF_NAME"'\n
            [**Issue ë³´ê¸°**]('"$CI_PROJECT_URL"'/-/issues/$CI_JOB_ID")"
          }' \
          https://meeting.ssafy.com/hooks/9ecrs1m8ybbtfpa5dxsms8n4zo || echo "Mattermost ì•Œë¦¼ ì‹¤íŒ¨"
      else
        echo "ğŸš« Issue ì •ë³´ ì—†ìŒ"
      fi
