stages:
  - notify

# Merge Request ë°œìƒ ì‹œ Mattermostë¡œ ì•Œë¦¼ ì „ì†¡
notify_mattermost:
  stage: notify
  script:
    - >
      if [ -n "$CI_MERGE_REQUEST_IID" ]; then 
        curl -X POST -H "Content-Type: application/json" \
          -d '{
            "text": "ğŸ”€ *ìƒˆë¡œìš´ Merge Requestê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!* ğŸ‰\n
            **í”„ë¡œì íŠ¸:** `'$CI_PROJECT_NAME'`\n
            **ì‘ì„±ì:** `'$GITLAB_USER_LOGIN'`\n
            **ë¸Œëœì¹˜:** `'$CI_COMMIT_REF_NAME'`\n
            **MR ì œëª©:** \"'${CI_MERGE_REQUEST_TITLE:-"ì œëª© ì—†ìŒ"}'\"\n
            [**Merge Request ë³´ê¸°**]('$CI_PROJECT_URL/-/merge_requests/$CI_MERGE_REQUEST_IID')"
          }' https://meeting.ssafy.com/hooks/9ecrs1m8ybbtfpa5dxsms8n4zo
      else
        echo "âŒ MR ì •ë³´ ì—†ìŒ"
      fi

# ì´ìŠˆ ë°œìƒ ì‹œ Mattermostë¡œ ì•Œë¦¼ ì „ì†¡
notify_issue:
  stage: notify
  script:
    - >
      if [ -n "$CI_COMMIT_MESSAGE" ]; then 
        curl -X POST -H "Content-Type: application/json" \
          -d '{
            "text": "ğŸ“Œ *ìƒˆë¡œìš´ ì´ìŠˆê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!* ğŸ“\n
            **í”„ë¡œì íŠ¸:** `'$CI_PROJECT_NAME'`\n
            **ì‘ì„±ì:** `'$GITLAB_USER_LOGIN'`\n
            **ì´ìŠˆ ì œëª©:** \"'${CI_COMMIT_MESSAGE:-"ì œëª© ì—†ìŒ"}'\"\n
            [**ì´ìŠˆ ë³´ê¸°**]('$CI_PROJECT_URL/-/issues/$CI_JOB_ID')"
          }' https://meeting.ssafy.com/hooks/9ecrs1m8ybbtfpa5dxsms8n4zo
      else
        echo "âŒ ì´ìŠˆ ì •ë³´ ì—†ìŒ"
      fi

# ìë™ í…ŒìŠ¤íŠ¸ ë° ë¹Œë“œ ë‹¨ê³„ ì¶”ê°€ (í•„ìš” ì‹œ)
test:
  stage: notify
  script:
    - echo "âœ… í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘..."
    - echo "í…ŒìŠ¤íŠ¸ ì„±ê³µ!"

# Runner íƒœê·¸ ì„¤ì • (ë“±ë¡í•œ Runnerì˜ íƒœê·¸ì— ë§ê²Œ ìˆ˜ì •)
tags:
  - docker
  - runner
  - gitlab
