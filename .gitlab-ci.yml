stages:
  - notify

# Merge Request ë°œìƒ ì‹œ Mattermostë¡œ ì•Œë¦¼ ì „ì†¡
notify_mattermost:
  stage: notify
  script:
    - |
      if [ -n "$CI_MERGE_REQUEST_IID" ]; then
        curl -X POST -H "Content-Type: application/json" \
        -d '{
          "text": "*ğŸ‰ ìƒˆë¡œìš´ Merge Requestê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!*",
          "attachments": [
            {
              "title": "í”„ë¡œì íŠ¸: '"$CI_PROJECT_NAME"'",
              "text": "**ì‘ì„±ì:** '"$GITLAB_USER_LOGIN"'\n**ë¸Œëœì¹˜:** '"$CI_COMMIT_REF_NAME"'\n**MR ì œëª©:** '"${CI_MERGE_REQUEST_TITLE:-ì œëª© ì—†ìŒ}"'\n[**Merge Request ë³´ê¸°**]('"$CI_PROJECT_URL"'/-/merge_requests/'"$CI_MERGE_REQUEST_IID"')"
            }
          ]
        }' \
        "https://meeting.ssafy.com/hooks/9ecrs1m8ybbtfpa5dxsms8n4zo"
      else
        echo "âŒ MR ì •ë³´ ì—†ìŒ"
      fi

# Issue ë°œìƒ ì‹œ Mattermostë¡œ ì•Œë¦¼ ì „ì†¡
notify_issue:
  stage: notify
  script:
    - |
      if [ -n "$CI_JOB_ID" ]; then
        curl -X POST -H "Content-Type: application/json" \
        -d '{
          "text": "*ğŸš¨ ìƒˆë¡œìš´ Issueê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!*",
          "attachments": [
            {
              "title": "í”„ë¡œì íŠ¸: '"$CI_PROJECT_NAME"'",
              "text": "**Job ID:** '"$CI_JOB_ID"'\n[**ì´ìŠˆ ë³´ê¸°**]('"$CI_PROJECT_URL"'/-/issues/'"$CI_JOB_ID"')"
            }
          ]
        }' \
        "https://meeting.ssafy.com/hooks/9ecrs1m8ybbtfpa5dxsms8n4zo"
      else
        echo "âŒ Issue ì •ë³´ ì—†ìŒ"
      fi
