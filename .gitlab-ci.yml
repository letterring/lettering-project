stages:
  - notify

notify_mattermost:
  stage: notify
  tags:
    - docker
    - runner
    - gitlab
  script:
    - apt-get update && apt-get install -y curl
    - >
      if [ -n "$CI_MERGE_REQUEST_IID" ]; then 
        curl -X POST -H "Content-Type: application/json" \
          -d '{
            "text": "ğŸ”€ *ìƒˆë¡œìš´ Merge Requestê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!* ğŸ‰\n
            **í”„ë¡œì íŠ¸:** `'$CI_PROJECT_NAME'`\n
            **ì‘ì„±ì:** `'$GITLAB_USER_LOGIN'`\n
            **ë¸Œëœì¹˜:** `'$CI_COMMIT_REF_NAME'`\n
            **MR ì œëª©:** \"'${CI_MERGE_REQUEST_TITLE:-"ì œëª© ì—†ìŒ"}'\"\n
            [**Merge Request ë³´ê¸°**]('$CI_PROJECT_URL/-/merge_requests/$CI_MERGE_REQUEST_IID')"
          }' https://meeting.ssafy.com/hooks/9ecrs1m8ybbtfpa5dxsms8n4zo
      else
        echo "âŒ MR ì •ë³´ ì—†ìŒ"
      fi

notify_issue:
  stage: notify
  tags:
    - docker
    - runner
    - gitlab
  script:
    - apt-get update && apt-get install -y curl
    - echo "CI_JOB_ID = $CI_JOB_ID"
    - >
      if [ -n "$CI_COMMIT_MESSAGE" ]; then 
        MESSAGE=$(echo -n "$CI_COMMIT_MESSAGE" | base64)
        curl -X POST -H "Content-Type: application/json" \
          -d '{
            "text": "ğŸ“Œ *ìƒˆë¡œìš´ ì´ìŠˆê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!* ğŸ“\n
            **í”„ë¡œì íŠ¸:** `'$CI_PROJECT_NAME'`\n
            **ì‘ì„±ì:** `'$GITLAB_USER_LOGIN'`\n
            **ì´ìŠˆ ì œëª©:** \"'$(echo $MESSAGE | base64 --decode)'\"\n
            [**ì´ìŠˆ ë³´ê¸°**]('$CI_PROJECT_URL/-/issues/$CI_JOB_ID')"
          }' https://meeting.ssafy.com/hooks/9ecrs1m8ybbtfpa5dxsms8n4zo
      else
        echo "âŒ ì´ìŠˆ ì •ë³´ ì—†ìŒ"
      fi
