# OpenJDK ê¸°ë°˜ì˜ Java 17 ì´ë¯¸ì§€ ì‚¬ìš©
FROM openjdk:17-jdk-slim

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# Gradle Wrapper ë° ì„¤ì • íŒŒì¼ ë³µì‚¬ (ìºì‹± ìµœì í™”)
COPY gradlew ./
COPY gradle ./gradle
COPY build.gradle ./
COPY settings.gradle ./

# Gradle Wrapper ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
RUN chmod +x gradlew

# ğŸ”¥ ì†ŒìŠ¤ ì½”ë“œ ë° ì„¤ì • íŒŒì¼ ë³µì‚¬
COPY src ./src

# ğŸ”¥ secrets.propertiesë„ ì´ë¯¸ì§€ì— í¬í•¨ì‹œí‚´
COPY src/main/resources/secrets.properties ./src/main/resources/secrets.properties

# Gradle ì˜ì¡´ì„± ë¯¸ë¦¬ ë‹¤ìš´ë¡œë“œ (ë¹Œë“œ ì†ë„ ê°œì„ )
RUN ./gradlew dependencies --no-daemon

# Gradle ë¹Œë“œ ì‹œ í…ŒìŠ¤íŠ¸ ì œì™¸
RUN ./gradlew build -x test --no-daemon

# ğŸ”¥ JAR íŒŒì¼ ë³µì‚¬
RUN cp build/libs/lettering-0.0.1-SNAPSHOT.jar /app/app.jar || echo "No JAR file found"

# í¬íŠ¸ ì„¤ì •
EXPOSE 8080

# ì‹¤í–‰ ëª…ë ¹ (ê²½ë¡œ ëª…ì‹œ)
ENTRYPOINT ["java", "-Dspring.config.additional-location=classpath:/secrets.properties", "-jar", "/app/app.jar"]
